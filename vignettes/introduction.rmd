---
title: "Introduction"
author: "Sebastian Ueckert"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


assemblerr is an R package to construct pharmacometric models by combining pre-defined model components. It's intended to simplify the specification of complex pharmacometric models and provide a mechanism to generate models in an automatic way. With assemblerr, models are specified using R code and then converted to a NONMEM control stream.   

# Quick start

## Load assemblerr 

```{r}
library(assemblerr)
```

## Build a simple model

```{r}
m <- model() +
  prm_log_normal("v") +
  prm_log_normal("cl") +
  obs_additive(conc~amt/v*exp(-cl/v*time)) 

```


## Generate NONMEM code

```{r}
render(m) 
```


# Workflow

The quick start example showed the general workflow in assemblerr:

  1. A model object is created using the `model()` function 
  2. Building blocks are added to the model using the `+` operator 
  3. The `render()` function generates the NMTRAN code  

No matter what type of model you are trying to assemble, this workflow will be the same. The difference lies in the creation function being used in step 1 and the building blocks being added in step 2. 

# Model types

The creation function defines the overal scope of the model by deciding which facets the model possesses. A facet is a particular feature of a model such as the model parameters or the compartments for differential equation models. Currently, assemblerr supports two types of pharmacometric models

  1. **General pharmacometric models:** The lowest level of abstraction that allows the creation of a wide range of models but requires a more fine-grained definition process.  
  2. **Pharmacokinetic models:** A higher level of abstraction that allows the definition of pharmacokinetic models with less effort.  


## General pharmacometric models

```{r}
# construct one-compartment 1st order elimination model
m <- model() +
  compartment("dose") +
  compartment("central", volume = ~vc) +
  flow(from = "dose", to = "central", definition = ~ka*A) +
  flow(from = "central", definition = ~cl*C) +
  prm_log_normal("cl") +
  prm_log_normal("vc") +
  obs_additive(conc~C["central"])

# convert to a NONMEM model and generate NMTran code
render(m)
```


## Pharmacokinetic models

For PK models assemblerr supports a higher level of abstraction to simplify the construction of these types of models.

```{r}
# construct one-compartment 1st order elimination model
pkm <- pk_model() +
  pk_absorption_rate_fo() +
  pk_elimination_linear() +
  pk_distribution_1cmp() +
  obs_additive(conc~C["central"]) 

# convert to a NONMEM model and generate NMTran code
render(pkm)

```

The basic building blocks can still be added to a PK model, allowing to customize the pre-defined structure.

```{r}
# change the parameter model for clearance
pkm2 <- pkm +
  prm_normal("cl")

# convert to a NONMEM model and generate NMTran code
render(pkm2)
```

# Building blocks
