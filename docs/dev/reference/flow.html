<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Flow between compartments — flow • assemblerr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Flow between compartments — flow"><meta property="og:description" content="This building block describes a flow between compartments."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">assemblerr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/getting-started.html">Getting started</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/UUPharmacometrics/assemblerr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Flow between compartments</h1>
    <small class="dont-index">Source: <a href="https://github.com/UUPharmacometrics/assemblerr/blob/HEAD/R/compartment.R" class="external-link"><code>R/compartment.R</code></a></small>
    <div class="hidden name"><code>flow.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This building block describes a flow between compartments.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flow</span><span class="op">(</span><span class="va">definition</span>, from <span class="op">=</span> <span class="cn">NA_character_</span>, to <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>definition</dt>
<dd><p>Equation describing the flow</p></dd>


<dt>from</dt>
<dd><p>Name of the source compartment (NA for an inflow without source)</p></dd>


<dt>to</dt>
<dd><p>Name of the sink compartment (NA for an outflow without sink)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A building block of type 'flow'</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Flows define the connections between compartments and the equations according to which exchanges occur.</p><div class="section">
<h3 id="flow-equations">Flow equations<a class="anchor" aria-label="anchor" href="#flow-equations"></a></h3>


<p>The first function argument is the flow equation. It is defined using R formulas that can start with the tilde <code>~</code> operator and do not
need to have a left-hand side (i.e., <code>~k0</code> is a valid flow definition).</p>
<p>Flow equations can contains the special variables <code>A</code> and <code>C</code> which can be used to refer to the amount and concentration in the compartment specified via
the <code>from=</code> argument. For example, the following code creates a flow building block describing the first-order transfer from the depot to the central
compartment</p>
<p></p><div class="sourceCode"><pre><code><a class="sourceLine" id="cb1-1" title="1"><span class="kw">flow</span>(<span class="op">~</span>ka<span class="op">*</span>A, <span class="st">"depot"</span>, <span class="st">"central"</span>)</a></code></pre><p></p></div>
<p>When the model is rendered, <code>A</code> and <code>C</code> will get replaced with the corresponding compartment reference. assemblerr will raise an error if <code>A</code> or <code>C</code> are used
without specifying the <code>from=</code> compartment (such as in an inflow).</p>
</div>

<div class="section">
<h3 id="compartment-connections">Compartment connections<a class="anchor" aria-label="anchor" href="#compartment-connections"></a></h3>


<p>The connection between compartments can be specified using the <code>from=</code> and <code>to=</code> arguments of the function. Setting either <code>from=</code> or <code>to=</code> to <code>NA</code> allows
the definition of in and outflows without a source or sink. Setting both arguments to <code>NA</code> results in error.</p>
</div>

<div class="section">
<h3 id="conversion-to-differential-equations">Conversion to differential equations<a class="anchor" aria-label="anchor" href="#conversion-to-differential-equations"></a></h3>


<p>When flows are rendered they are converted to ordinary differential equations (ODEs). The connection between compartments together with the flow equations allow
assemblerr to determine whether an analytic solution can be generated. This automatic optimization of differential equations can be disabled via the rendering
options.</p>
</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># one-compartment model with first-order elimination</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="model.html">model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"v"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"cl"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="compartment.html">compartment</a></span><span class="op">(</span><span class="st">"central"</span>, volume <span class="op">=</span> <span class="op">~</span><span class="va">v</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu">flow</span><span class="op">(</span><span class="fu"><a href="declaration.html">declaration</a></span><span class="op">(</span><span class="op">~</span><span class="va">cl</span><span class="op">*</span><span class="va">C</span><span class="op">)</span>, from <span class="op">=</span> <span class="st">"central"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="op">~</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># an analytic solution is generated</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render.html">render</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PROBLEM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $INPUT ID TIME DV AMT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $DATA data.csv IGNORE=@</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $SUBROUTINES ADVAN1  TRANS2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PK</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> V = THETA(1) * EXP(ETA(1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CL = THETA(2) * EXP(ETA(2))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ERROR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Y = A(1)/V + EPS(1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ESTIMATION METHOD=COND MAXEVAL=999999 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $THETA (0, 1, Inf) ; POP_V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $THETA (0, 1, Inf) ; POP_CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $OMEGA 0.1 ; IIV_V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $OMEGA 0.1 ; IIV_CL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $SIGMA 1; RUV_ADD</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># one-compartment model with Michaelis-Menten elimination</span></span></span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="model.html">model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"v"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"vmax"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="prm_no_var.html">prm_no_var</a></span><span class="op">(</span><span class="st">"km"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="compartment.html">compartment</a></span><span class="op">(</span><span class="st">"central"</span>, volume <span class="op">=</span> <span class="op">~</span><span class="va">v</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu">flow</span><span class="op">(</span><span class="fu"><a href="declaration.html">declaration</a></span><span class="op">(</span><span class="op">~</span><span class="va">vmax</span><span class="op">*</span><span class="va">C</span><span class="op">/</span><span class="op">(</span><span class="va">km</span><span class="op">+</span><span class="va">C</span><span class="op">)</span><span class="op">)</span>, from <span class="op">=</span> <span class="st">"central"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="op">~</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># an ODE is generated</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render.html">render</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PROBLEM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $INPUT ID TIME DV AMT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $DATA data.csv IGNORE=@</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $SUBROUTINES ADVAN13 TOL=6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $MODEL COMP=(CENTRAL)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PK</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> V = THETA(1) * EXP(ETA(1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> VMAX = THETA(2) * EXP(ETA(2))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KM = THETA(3)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $DES</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DADT(1) = -(VMAX * (A(1)/V)/(KM + A(1)/V))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ERROR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Y = A(1)/V + EPS(1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ESTIMATION METHOD=COND MAXEVAL=999999 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $THETA (0, 1, Inf) ; POP_V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $THETA (0, 1, Inf) ; POP_VMAX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $THETA (0, 1, Inf) ; POP_KM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $OMEGA 0.1 ; IIV_V</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $OMEGA 0.1 ; IIV_VMAX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $SIGMA 1; RUV_ADD</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Ueckert, F. Hoffmann-La Roche Ltd..</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

