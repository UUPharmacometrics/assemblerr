<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started • assemblerr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="assemblerr">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">assemblerr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/UUPharmacometrics/assemblerr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started</h1>
                        <h4 data-toc-skip class="author">Sebastian Ueckert</h4>
            
            <h4 data-toc-skip class="date">2022-09-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UUPharmacometrics/assemblerr/blob/HEAD/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<p>assemblerr is an R package helping you build pharmacometric models quickly and without hassle. The package allows you to assemble a model from a set of predefined building blocks and then convert it to NONMEM code. This document will show you the most important steps when working with assemblerr and is an excellent place to start if you are new to the package. We will use a few examples to discuss how to :</p>
<ul>
<li><a href="#assemble-a-simple-model">Assemble a simple model</a></li>
<li>
<a href="#check-and-modify">Check and modify</a> the model</li>
<li>Turn the assembled model into NONMEM code using <a href="#rendering">rendering</a>
</li>
<li>Specify what <a href="#tasks">tasks</a> the model code should implement</li>
<li>Write more complex models using [differential equations]</li>
<li>Create <a href="#pharmacokinetic-models">pharmacokinetic models</a> even faster</li>
<li>And get <a href="#more-help">more help</a>
</li>
</ul>
<div class="section level2">
<h2 id="assemble-a-simple-model">Assemble a simple model<a class="anchor" aria-label="anchor" href="#assemble-a-simple-model"></a>
</h2>
<p>Let’s start simple and assume you want to build a dose-response model using an Emax function. The following code would accomplish that:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"emax"</span>, median <span class="op">=</span> <span class="fl">10</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"ed50"</span>, median <span class="op">=</span> <span class="fl">50</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/algebraic.html">algebraic</a></span><span class="op">(</span><span class="va">effect</span><span class="op">~</span><span class="va">emax</span><span class="op">*</span><span class="va">dose</span><span class="op">/</span><span class="op">(</span><span class="va">ed50</span> <span class="op">+</span> <span class="va">dose</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="op">~</span><span class="va">effect</span>, var_add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The first line is the so-called constructor, something like the foundation of what you are trying to build. In this example, we are building a general pharmacometric model. Later, we will discuss when and why you would choose something else. All other lines specify building blocks and combine them using the <code>+</code> operator. What each of the building blocks defines is hopefully clear from its name, but let’s go through them anyway to be sure:</p>
<ul>
<li>Line 2 and 3 define the parameters “emax” and “ed50” as being log-normally distributed with a specific median and variance on the log-scale.</li>
<li>Line 4 defines the algebraic relationship for the variable effect using a classical <code>R</code> formula. In these formulae, the <code>~</code> should be understood like a <code>=</code>. You can use formulae in assemblerr whenever you want to define a mathematical relationship.<br>
</li>
<li>Line 5 defines the observational model, i.e., what is the observation in the model (the variable “effect” in this case) as well as the model for residual error (additive) and the variance of the error term.</li>
</ul>
<p>Let’s assume you want to create a model with a proportional error model instead and change the initial estimate for it, you would simply need to exchange the last line to something like <code>obs_proportional(~effect, var_prop = 0.05)</code>. Similarly, if you would want to switch one of the parameters shown above, you could also change it. The use of these exchangeable building blocks is the core principle in assemblerr.</p>
</div>
<div class="section level2">
<h2 id="check-and-modify">Check and modify<a class="anchor" aria-label="anchor" href="#check-and-modify"></a>
</h2>
<p>When you are done defining your model you can check whether it contains any issues using the <code><a href="../reference/check.html">check()</a></code> function, e.g.,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check.html">check</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ⚠ 1 <span style="color: #BB0000;">critical</span><span> issue</span></span></span></code></pre>
<pre><code><span><span class="co">##   <span style="color: #BB0000;">1. Undefined variable 'dose' in algebraics</span></span></span></code></pre>
<p>In this case, the model definition used the variable ‘dose’ without it being declared. You can tell assemblerr that dose is part of the dataset by modifying the model as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/input_variables.html">input_variable</a></span><span class="op">(</span><span class="st">"dose"</span><span class="op">)</span></span></code></pre></div>
<p>Now, the check function does not find any issues:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check.html">check</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span><span> No issues</span></span></span></code></pre>
<p>You can also replace an already existing building block by adding a new one with the same name. For example, the following code updates the parameter model for the Emax parameter to one without variability:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_no_var.html">prm_no_var</a></span><span class="op">(</span><span class="st">"emax"</span>, value <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Building block replaced</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span><span> The building block [emax: log-normal] has been replaced with [emax: no variability]</span></span></span></code></pre>
<p>The warning message indicates that an existing building block has been replace. Now, there won’t be any random effect associated with Emax when you render the modified model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT DOSE ID DV</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $PRED</span></span>
<span><span class="co">## EMAX = THETA(1)</span></span>
<span><span class="co">## ED50 = THETA(2) * EXP(ETA(1))</span></span>
<span><span class="co">## EFFECT = EMAX * DOSE/(ED50 + DOSE)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_ED50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_ED50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="rendering">Rendering<a class="anchor" aria-label="anchor" href="#rendering"></a>
</h2>
<p>After having defined your model, you probably want to turn it into something useful, in assemblerr this process is called rendering. Since we stored our assembled model above in the variable <code>m</code> we can simply pass this variable to the <code>render</code> function, which will write the resulting NONMEM code to the console, like so</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT DOSE ID DV</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $PRED</span></span>
<span><span class="co">## EMAX = THETA(1)</span></span>
<span><span class="co">## ED50 = THETA(2) * EXP(ETA(1))</span></span>
<span><span class="co">## EFFECT = EMAX * DOSE/(ED50 + DOSE)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_ED50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_ED50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>While this is great to quickly check the resulting code, we generally want a model file. We can create it using the <code>filename=</code> argument of the <code><a href="../reference/render.html">render()</a></code> function, i.e.,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m</span>, filename <span class="op">=</span> <span class="st">"run1.mod"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>render</code> function also has an options argument that allows you to modify some aspects of the rendering process. For example, the following code automatically adds the mu-referenced code for all parameters.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>, </span>
<span>  options <span class="op">=</span> <span class="fu"><a href="../reference/assemblerr_options.html">assemblerr_options</a></span><span class="op">(</span></span>
<span>    prm.use_mu_referencing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT DOSE ID DV</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $PRED</span></span>
<span><span class="co">## EMAX = THETA(1)</span></span>
<span><span class="co">## MU_1 = LOG(THETA(2))</span></span>
<span><span class="co">## ED50 = EXP(MU_1 + ETA(1))</span></span>
<span><span class="co">## EFFECT = EMAX * DOSE/(ED50 + DOSE)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_ED50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_ED50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="tasks">Tasks<a class="anchor" aria-label="anchor" href="#tasks"></a>
</h2>
<p>“All models are wrong” AND useless if we cannot do anything with them. So far, you only saw the description of a model. The <code>tasks=</code> argument of the <code><a href="../reference/render.html">render()</a></code> function allows you to specify what the model should “do”.</p>
<p>By default assemblerr adds an estimation task using the FOCE algorithm but you can change that, for example using:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m</span>, </span>
<span>       tasks <span class="op">=</span> <span class="fu"><a href="../reference/tsk_estimation.html">tsk_estimation</a></span><span class="op">(</span>algorithm <span class="op">=</span> <span class="st">"imp"</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT DOSE ID DV</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $PRED</span></span>
<span><span class="co">## EMAX = THETA(1)</span></span>
<span><span class="co">## ED50 = THETA(2) * EXP(ETA(1))</span></span>
<span><span class="co">## EFFECT = EMAX * DOSE/(ED50 + DOSE)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=IMP AUTO=1 </span></span>
<span><span class="co">## $COVARIANCE PRINT=E</span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_ED50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_ED50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>This example also requested the standard errors for the estimated parameters, which resulted in the addition of the covariance step in the NONMEM code.</p>
<p>You can combine multiple tasks using the <code>+</code> operator. For example, you might want to estimate parameters and output the parameter values for all parameters in the model. The following code accomplishes this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m</span>, </span>
<span>       tasks <span class="op">=</span> <span class="fu"><a href="../reference/tsk_estimation.html">tsk_estimation</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/tsk_output.html">tsk_output</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"sdtab"</span>, variables <span class="op">=</span> <span class="fu"><a href="../reference/model-variable-selection.html">vars_prms</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT DOSE ID DV</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $PRED</span></span>
<span><span class="co">## EMAX = THETA(1)</span></span>
<span><span class="co">## ED50 = THETA(2) * EXP(ETA(1))</span></span>
<span><span class="co">## EFFECT = EMAX * DOSE/(ED50 + DOSE)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $TABLE EMAX ED50 FILE=sdtab NOAPPEND NOPRINT</span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_ED50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_ED50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>In the previous example, you saw the variable selection helper <code><a href="../reference/model-variable-selection.html">vars_prms()</a></code> in action. Variable selection helpers allow you to specify what variables should be used in a table. You can read more about them in the documentation for the <code><a href="../reference/tsk_output.html">tsk_output()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="ordinary-differential-equations">Ordinary differential equations<a class="anchor" aria-label="anchor" href="#ordinary-differential-equations"></a>
</h2>
<p>Many pharmacometric models are defined using ordinary differential equations. In assemblerr you can specify ordinary differential equations via compartments and flows (while this does not cover all types of ordinary differential equations, it will hopefully get you pretty far). To show compartment and flows in action, we will extend the dose-response model from the beginning to a concentration-response model. The following code chunk shows the necessary changes:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"v"</span>, median <span class="op">=</span> <span class="fl">100</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"cl"</span>, median <span class="op">=</span> <span class="fl">10</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"emax"</span>, median <span class="op">=</span> <span class="fl">10</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_log_normal.html">prm_log_normal</a></span><span class="op">(</span><span class="st">"ec50"</span>, median <span class="op">=</span> <span class="fl">1</span>, var_log <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/compartment.html">compartment</a></span><span class="op">(</span><span class="st">"central"</span>, volume <span class="op">=</span> <span class="st">"v"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"central"</span>, definition <span class="op">=</span> <span class="op">~</span><span class="va">cl</span><span class="op">*</span><span class="va">C</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="va">effect</span><span class="op">~</span><span class="va">emax</span><span class="op">*</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">ec50</span> <span class="op">+</span> <span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span>, var_add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>In this model definition, we used two additional parameters and, more importantly, a compartment as well as a flow from that compartment. You should note, how you can use the variable <code>C</code> in the flow definition to refer to the concentration in the “from” compartment. Similarly, you can also use <code>C["central"]</code> to refer to the concentration in the central compartment when defining the observational model. The <code>A</code> variable provides a reference to the amount in the compartment.</p>
<p>Pay attention to how assemblerr replaces the <code>C</code> variables with the corresponding compartment reference when we render the model like before:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT ID TIME DV AMT</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $SUBROUTINES ADVAN1  TRANS2 </span></span>
<span><span class="co">## $PK</span></span>
<span><span class="co">## V = THETA(1) * EXP(ETA(1))</span></span>
<span><span class="co">## CL = THETA(2) * EXP(ETA(2))</span></span>
<span><span class="co">## EMAX = THETA(3) * EXP(ETA(3))</span></span>
<span><span class="co">## EC50 = THETA(4) * EXP(ETA(4))</span></span>
<span><span class="co">## $ERROR</span></span>
<span><span class="co">## EFFECT = EMAX * (A(1)/V)/(EC50 + A(1)/V)</span></span>
<span><span class="co">## Y = EFFECT + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 100, Inf) ; POP_V</span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_CL</span></span>
<span><span class="co">## $THETA (0, 10, Inf) ; POP_EMAX</span></span>
<span><span class="co">## $THETA (0, 1, Inf) ; POP_EC50</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_V</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_CL</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_EMAX</span></span>
<span><span class="co">## $OMEGA 0.09 ; IIV_EC50</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>Did you also notice what happened to the differential equation? It disappeared! assemblerr recognized that this simple one-compartment model could be written as a much quicker analytical solution using ADVAN1 and did the necessary replacements.</p>
</div>
<div class="section level2">
<h2 id="pharmacokinetic-models">Pharmacokinetic models<a class="anchor" aria-label="anchor" href="#pharmacokinetic-models"></a>
</h2>
<p>For PK models, assemblerr supports building blocks with a higher level of abstraction. The following snippet assembles a one-compartment model with linear elimination:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pk_model.html">pk_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_absorption_fo.html">pk_absorption_fo</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_distribution_1cmp.html">pk_distribution_1cmp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_elimination_linear.html">pk_elimination_linear</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="va">conc</span><span class="op">~</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span> </span></code></pre></div>
<p>You can see how <code><a href="../reference/pk_model.html">pk_model()</a></code> instead of <code><a href="../reference/model.html">model()</a></code> was used as a constructor. The resulting model objects accepts building blocks such as:</p>
<ul>
<li>A first-order absorption model (line 2)</li>
<li>A compartment distribution model (line 3)</li>
<li>A linear elimination model (line 4)</li>
</ul>
<p>as well as the additive observation model (line 5) that you saw before.</p>
<p>Despite its slightly different nature, you can turn the model into NONMEM code using the <code><a href="../reference/render.html">render()</a></code> function. Also, tasks and rendering options work like in the previous examples. You could therefore do the following to create NONMEM code with mu-referencing, importance sampling estimation, and a table containing all model parameters:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">pkm</span>, </span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/tsk_estimation.html">tsk_estimation</a></span><span class="op">(</span><span class="st">"imp"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/tsk_output.html">tsk_output</a></span><span class="op">(</span><span class="st">"sdtab"</span>, variables <span class="op">=</span> <span class="fu"><a href="../reference/model-variable-selection.html">vars_prms</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="../reference/assemblerr_options.html">assemblerr_options</a></span><span class="op">(</span>prm.use_mu_referencing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT ID TIME DV AMT</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $SUBROUTINES ADVAN2  TRANS2 </span></span>
<span><span class="co">## $PK</span></span>
<span><span class="co">## MU_1 = LOG(THETA(1))</span></span>
<span><span class="co">## MAT = EXP(MU_1 + ETA(1))</span></span>
<span><span class="co">## MU_2 = LOG(THETA(2))</span></span>
<span><span class="co">## VC = EXP(MU_2 + ETA(2))</span></span>
<span><span class="co">## MU_3 = LOG(THETA(3))</span></span>
<span><span class="co">## CL = EXP(MU_3 + ETA(3))</span></span>
<span><span class="co">## KA = 1/MAT</span></span>
<span><span class="co">## V = VC</span></span>
<span><span class="co">## $ERROR</span></span>
<span><span class="co">## CONC = A(2)/VC</span></span>
<span><span class="co">## Y = CONC + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=IMP AUTO=1 </span></span>
<span><span class="co">## $TABLE MAT VC CL FILE=sdtab NOAPPEND NOPRINT</span></span>
<span><span class="co">## $THETA (0, 0.5, Inf) ; POP_MAT</span></span>
<span><span class="co">## $THETA (0, 100, Inf) ; POP_VC</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_CL</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_MAT</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_VC</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_CL</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>PK model building blocks come with a default parameter model for their parameters. You can change the default by providing the parameter model as an argument to the building blocks. For example, if you want to have no variability on the volume of distribution, you could use the following code (note also how VC was renamed to V1):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pk_model.html">pk_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_absorption_fo.html">pk_absorption_fo</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_distribution_1cmp.html">pk_distribution_1cmp</a></span><span class="op">(</span>prm_vc <span class="op">=</span> <span class="fu"><a href="../reference/prm_no_var.html">prm_no_var</a></span><span class="op">(</span><span class="st">"v1"</span>, value <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_elimination_linear.html">pk_elimination_linear</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="va">conc</span><span class="op">~</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">pkm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT ID TIME DV AMT</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $SUBROUTINES ADVAN2  TRANS2 </span></span>
<span><span class="co">## $PK</span></span>
<span><span class="co">## MAT = THETA(1) * EXP(ETA(1))</span></span>
<span><span class="co">## V1 = THETA(2)</span></span>
<span><span class="co">## CL = THETA(3) * EXP(ETA(2))</span></span>
<span><span class="co">## KA = 1/MAT</span></span>
<span><span class="co">## V = V1</span></span>
<span><span class="co">## $ERROR</span></span>
<span><span class="co">## CONC = A(2)/V1</span></span>
<span><span class="co">## Y = CONC + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 0.5, Inf) ; POP_MAT</span></span>
<span><span class="co">## $THETA (0, 100, Inf) ; POP_V1</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_CL</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_MAT</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_CL</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
<p>Alternatively, you can overwrite the default parameter model by adding a another one with the same name, i.e., :</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pk_model.html">pk_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_absorption_fo.html">pk_absorption_fo</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_distribution_1cmp.html">pk_distribution_1cmp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pk_elimination_linear.html">pk_elimination_linear</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/prm_no_var.html">prm_no_var</a></span><span class="op">(</span><span class="st">"vc"</span>, value <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/obs_additive.html">obs_additive</a></span><span class="op">(</span><span class="va">conc</span><span class="op">~</span><span class="va">C</span><span class="op">[</span><span class="st">"central"</span><span class="op">]</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Warning: Building block replaced</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span><span> The building block [vc: log-normal] has been replaced with [vc: no variability]</span></span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">pkm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROBLEM</span></span>
<span><span class="co">## $INPUT ID TIME DV AMT</span></span>
<span><span class="co">## $DATA data.csv IGNORE=@</span></span>
<span><span class="co">## $SUBROUTINES ADVAN2  TRANS2 </span></span>
<span><span class="co">## $PK</span></span>
<span><span class="co">## MAT = THETA(1) * EXP(ETA(1))</span></span>
<span><span class="co">## VC = THETA(2)</span></span>
<span><span class="co">## CL = THETA(3) * EXP(ETA(2))</span></span>
<span><span class="co">## KA = 1/MAT</span></span>
<span><span class="co">## V = VC</span></span>
<span><span class="co">## $ERROR</span></span>
<span><span class="co">## CONC = A(2)/VC</span></span>
<span><span class="co">## Y = CONC + EPS(1)</span></span>
<span><span class="co">## $ESTIMATION METHOD=COND MAXEVAL=999999 </span></span>
<span><span class="co">## $THETA (0, 0.5, Inf) ; POP_MAT</span></span>
<span><span class="co">## $THETA (0, 100, Inf) ; POP_VC</span></span>
<span><span class="co">## $THETA (0, 50, Inf) ; POP_CL</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_MAT</span></span>
<span><span class="co">## $OMEGA 0.1 ; IIV_CL</span></span>
<span><span class="co">## $SIGMA 1; RUV_ADD</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="more-help">More help<a class="anchor" aria-label="anchor" href="#more-help"></a>
</h2>
<p>There is more to learn about assemblerr and you have multiple sources available:</p>
<ul>
<li>Help for a specific function can be found in the reference documentation in R. It can be accessed using <code>?</code>. For example, <code><a href="../reference/prm_log_normal.html">?prm_log_normal</a></code> will open the documentation for the log-normal parameter building block. You can find links to similar building blocks at the bottom of each help page.</li>
<li>An overview of the available documentation is available via <code><a href="https://rdrr.io/pkg/assemblerr/man" class="external-link">help(package="assemblerr")</a></code>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sebastian Ueckert, F. Hoffmann-La Roche Ltd..</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
